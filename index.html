<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basis Target Intelligence | CPA Firm Opportunities</title>

    <!-- Basis fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&family=Oxygen:wght@400;700&display=swap" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* ============================================
           BASIS-INSPIRED DARK THEME
           Using Basis brand colors & typography
           ============================================ */

        :root {
            /* Basis brand colors */
            --basis-teal: #41666F;
            --basis-teal-light: #5a8a95;
            --basis-teal-dark: #254951;

            /* Dark theme palette */
            --bg-primary: #121518;
            --bg-secondary: #1a1d21;
            --bg-elevated: #22262b;
            --bg-hover: #2a2f35;

            /* Text */
            --text-primary: #f0f0f0;
            --text-secondary: #8a9199;
            --text-muted: #5c6370;

            /* Borders */
            --border-subtle: #2a2f35;
            --border-default: #363c44;

            /* Priority colors */
            --priority-high: #4ade80;
            --priority-medium: #fbbf24;
            --priority-low: #6b7280;
            --priority-current: #5a8a95;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Oxygen', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-subtle);
            padding: 18px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 22px;
            font-weight: 500;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .logo-divider {
            width: 1px;
            height: 20px;
            background: var(--border-default);
        }

        .logo-sub {
            font-family: 'Oxygen', sans-serif;
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: 36px;
        }

        .nav-link {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 8px 14px;
            border: 1px solid var(--border-subtle);
            border-radius: 5px;
            background: var(--bg-elevated);
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-link:hover {
            border-color: var(--basis-teal);
            color: var(--basis-teal-light);
            background: var(--bg-hover);
        }

        .nav-link svg {
            width: 14px;
            height: 14px;
        }

        .header-stats {
            display: flex;
            gap: 36px;
        }

        .stat {
            text-align: right;
        }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 26px;
            font-weight: 500;
            color: var(--basis-teal-light);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-top: 4px;
        }

        /* Main layout */
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: 400px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
        }

        /* Filters */
        .filters {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border-subtle);
            background: var(--bg-primary);
        }

        .filters-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 14px;
        }

        .filter-row {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            padding: 7px 14px;
            font-size: 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-family: 'Oxygen', sans-serif;
        }

        .filter-btn:hover {
            border-color: var(--basis-teal);
            color: var(--basis-teal-light);
            background: var(--bg-hover);
        }

        .filter-btn.active {
            background: var(--basis-teal-dark);
            border-color: var(--basis-teal);
            color: var(--text-primary);
        }

        .filter-select {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            padding: 7px 14px;
            font-size: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Oxygen', sans-serif;
            min-width: 145px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--basis-teal);
        }

        /* Firm list */
        .firm-list {
            flex: 1;
            overflow-y: auto;
        }

        .firm-list::-webkit-scrollbar {
            width: 6px;
        }

        .firm-list::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .firm-list::-webkit-scrollbar-thumb {
            background: var(--border-default);
            border-radius: 3px;
        }

        .list-header {
            padding: 14px 20px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-subtle);
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            justify-content: space-between;
        }

        .firm-card {
            padding: 14px 20px;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .firm-card:hover {
            background: var(--bg-elevated);
        }

        .firm-card.active {
            background: rgba(65, 102, 111, 0.15);
            border-left: 3px solid var(--basis-teal);
        }

        .firm-card.hidden {
            display: none;
        }

        .firm-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .firm-name {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 14px;
        }

        .firm-location {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .priority-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            padding: 4px 8px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .priority-high {
            background: rgba(74, 222, 128, 0.15);
            color: var(--priority-high);
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .priority-medium {
            background: rgba(251, 191, 36, 0.15);
            color: var(--priority-medium);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .priority-low {
            background: rgba(107, 114, 128, 0.15);
            color: var(--priority-low);
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .priority-current {
            background: rgba(90, 138, 149, 0.2);
            color: var(--priority-current);
            border: 1px solid rgba(90, 138, 149, 0.4);
        }

        .firm-stats {
            display: flex;
            gap: 18px;
            margin-top: 8px;
        }

        .firm-stat {
            font-size: 12px;
        }

        .firm-stat-label {
            color: var(--text-muted);
        }

        .firm-stat-value {
            color: var(--text-secondary);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }

        .firm-opportunity {
            margin-top: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 500;
            color: var(--basis-teal-light);
        }

        .firm-opportunity.na {
            color: var(--text-muted);
        }

        /* Map container */
        #map {
            flex: 1;
            background: var(--bg-primary);
        }

        .leaflet-container {
            background: var(--bg-primary);
        }

        .leaflet-control-zoom {
            border: none !important;
        }

        .leaflet-control-zoom a {
            background: var(--bg-elevated) !important;
            color: var(--text-secondary) !important;
            border: 1px solid var(--border-subtle) !important;
        }

        .leaflet-control-zoom a:hover {
            background: var(--basis-teal-dark) !important;
            color: var(--text-primary) !important;
        }

        /* Popup */
        .leaflet-popup-content-wrapper {
            background: var(--bg-elevated);
            border: 1px solid var(--border-default);
            border-radius: 6px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .leaflet-popup-tip {
            background: var(--bg-elevated);
        }

        .leaflet-popup-content {
            margin: 14px 18px;
            color: var(--text-primary);
            font-family: 'Oxygen', sans-serif;
        }

        .leaflet-popup-close-button {
            color: var(--text-muted) !important;
        }

        .popup-title {
            font-weight: 700;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .popup-detail {
            font-size: 12px;
            color: var(--text-secondary);
            margin: 5px 0;
        }

        .popup-detail strong {
            color: var(--text-muted);
        }

        .popup-opportunity {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-subtle);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            font-size: 16px;
            color: var(--basis-teal-light);
        }

        .popup-notes {
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Footer */
        .methodology-link {
            padding: 14px 20px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-subtle);
            font-size: 11px;
            color: var(--text-muted);
        }

        .methodology-link a {
            color: var(--basis-teal-light);
            text-decoration: none;
        }

        .methodology-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <div class="logo">basis</div>
            <div class="logo-divider"></div>
            <div class="logo-sub">Target Intelligence Map</div>
        </div>
        <nav class="header-nav">
            <a href="agents/transaction-classifier/index.html" class="nav-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Transaction Classifier
            </a>
            <a href="agents/bank-reconciliation/index.html" class="nav-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                Bank Reconciliation
            </a>
            <a href="agents/journal-entry-generator/index.html" class="nav-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 7h6m-6 4h6m-6 4h4m-7 4h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
                Journal Entry Generator
            </a>
            <a href="agents/orchestrator/index.html" class="nav-link">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
                </svg>
                Multi-Agent Orchestrator
            </a>
        </nav>
        <div class="header-stats">
            <div class="stat">
                <div class="stat-value" id="filtered-count">0</div>
                <div class="stat-label">Target Firms</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="total-opportunity">$0</div>
                <div class="stat-label">Total Opportunity</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="total-employees">0</div>
                <div class="stat-label">Employees</div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <div class="filters">
                <div class="filters-title">Filters</div>

                <div class="filter-row">
                    <button class="filter-btn active" data-priority="all">All</button>
                    <button class="filter-btn" data-priority="high">High Priority</button>
                    <button class="filter-btn" data-priority="medium">Medium</button>
                    <button class="filter-btn" data-priority="low">Low</button>
                </div>

                <div class="filter-row">
                    <select class="filter-select" id="region-filter">
                        <option value="all">All Regions</option>
                        <option value="northeast">Northeast</option>
                        <option value="southeast">Southeast</option>
                        <option value="midwest">Midwest</option>
                        <option value="southwest">Southwest</option>
                        <option value="west">West</option>
                    </select>

                    <select class="filter-select" id="opportunity-filter">
                        <option value="all">All Opportunities</option>
                        <option value="1m+">$1M+</option>
                        <option value="500k+">$500K+</option>
                        <option value="250k+">$250K+</option>
                        <option value="under250k">Under $250K</option>
                    </select>
                </div>
            </div>

            <div class="list-header">
                <span>Target Accounts</span>
                <span id="showing-count">0 firms</span>
            </div>

            <div class="firm-list" id="firm-list"></div>

            <div class="methodology-link">
                Opportunity = Est. CAS Staff Ã— $5K/seat/yr. <a href="RESEARCH.md" target="_blank">View methodology</a>
                <div style="margin-top: 0.5rem;">Basis Deployed Intelligence for Jake McCorkle</div>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ============================================
        // FIRM DATA - 45 CPA Firms
        // ============================================
        const firms = [
            // === CURRENT CUSTOMER ===
            {
                id: 1,
                name: "Wiss & Company",
                city: "Florham Park",
                state: "NJ",
                region: "northeast",
                lat: 40.7879,
                lng: -74.3882,
                employees: 450,
                revenue: 95000000,
                opportunity: 405000,
                priority: "current",
                notes: "Current Basis customer. 30% time savings reported. Flagship case study."
            },

            // === HIGH PRIORITY ===
            {
                id: 2,
                name: "Withum Smith+Brown",
                city: "Princeton",
                state: "NJ",
                region: "northeast",
                lat: 40.3573,
                lng: -74.6672,
                employees: 2000,
                revenue: 420000000,
                opportunity: 1800000,
                priority: "high",
                notes: "Top 25 firm. Strong innovation lab. Heavy CAS focus. Same region as Wiss."
            },
            {
                id: 3,
                name: "CohnReznick",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7549,
                lng: -73.9840,
                employees: 3800,
                revenue: 850000000,
                opportunity: 3420000,
                priority: "high",
                notes: "Top 15 firm. Major AI investments. Strong advisory/CAS services."
            },
            {
                id: 4,
                name: "Citrin Cooperman",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7614,
                lng: -73.9776,
                employees: 1600,
                revenue: 350000000,
                opportunity: 1440000,
                priority: "high",
                notes: "Fast-growing through acquisitions. Tech-forward culture. Strong CAS."
            },
            {
                id: 5,
                name: "Armanino",
                city: "San Ramon",
                state: "CA",
                region: "west",
                lat: 37.7799,
                lng: -121.9780,
                employees: 1400,
                revenue: 320000000,
                opportunity: 1260000,
                priority: "high",
                notes: "West Coast innovation leader. Blockchain/crypto practice. Tech-native culture."
            },
            {
                id: 6,
                name: "EisnerAmper",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7484,
                lng: -73.9857,
                employees: 2500,
                revenue: 550000000,
                opportunity: 2250000,
                priority: "high",
                notes: "Top 20 firm. Established AI working group. Growing CAS practice."
            },
            {
                id: 7,
                name: "Cherry Bekaert",
                city: "Raleigh",
                state: "NC",
                region: "southeast",
                lat: 35.7796,
                lng: -78.6382,
                employees: 2600,
                revenue: 400000000,
                opportunity: 2340000,
                priority: "high",
                notes: "Largest Southeast-HQ firm. Digital transformation leader. Strong CAS growth."
            },
            {
                id: 8,
                name: "Sikich",
                city: "Naperville",
                state: "IL",
                region: "midwest",
                lat: 41.7508,
                lng: -88.1535,
                employees: 1600,
                revenue: 340000000,
                opportunity: 1440000,
                priority: "high",
                notes: "PE-backed growth. Strong technology consulting arm. Microsoft partner."
            },
            {
                id: 9,
                name: "Aprio",
                city: "Atlanta",
                state: "GA",
                region: "southeast",
                lat: 33.8463,
                lng: -84.3621,
                employees: 1200,
                revenue: 260000000,
                opportunity: 1080000,
                priority: "high",
                notes: "Fast-growing. Innovation-focused culture. Strong CAS and advisory."
            },
            {
                id: 10,
                name: "PKF O'Connor Davies",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7506,
                lng: -73.9936,
                employees: 1100,
                revenue: 250000000,
                opportunity: 990000,
                priority: "high",
                notes: "#25 largest firm. Growth through acquisitions. Tech-forward leadership."
            },
            {
                id: 11,
                name: "Anchin",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7580,
                lng: -73.9855,
                employees: 500,
                revenue: 140000000,
                opportunity: 450000,
                priority: "high",
                notes: "Boutique NYC firm. Early technology adopter. Strong CAS for real estate."
            },
            {
                id: 12,
                name: "KSM (Katz Sapper & Miller)",
                city: "Indianapolis",
                state: "IN",
                region: "midwest",
                lat: 39.7684,
                lng: -86.1581,
                employees: 700,
                revenue: 160000000,
                opportunity: 630000,
                priority: "high",
                notes: "Midwest leader. Strong client advisory services. Growth-oriented."
            },
            {
                id: 13,
                name: "Wipfli",
                city: "Milwaukee",
                state: "WI",
                region: "midwest",
                lat: 43.0389,
                lng: -87.9065,
                employees: 3400,
                revenue: 600000000,
                opportunity: 3060000,
                priority: "high",
                notes: "Top 20 firm. Strong in manufacturing/healthcare. Major CAS practice."
            },
            {
                id: 14,
                name: "Carr Riggs & Ingram",
                city: "Enterprise",
                state: "AL",
                region: "southeast",
                lat: 31.3307,
                lng: -85.8552,
                employees: 2400,
                revenue: 450000000,
                opportunity: 2160000,
                priority: "high",
                notes: "Top 25 firm. Rapid growth. Strong Southeast presence. CAS focus."
            },
            {
                id: 15,
                name: "The Bonadio Group",
                city: "Rochester",
                state: "NY",
                region: "northeast",
                lat: 43.1566,
                lng: -77.6088,
                employees: 900,
                revenue: 180000000,
                opportunity: 810000,
                priority: "high",
                notes: "Top Mid-Atlantic firm. Strong CAS/outsourcing practice. Growth through M&A."
            },
            {
                id: 16,
                name: "GHJ",
                city: "Los Angeles",
                state: "CA",
                region: "west",
                lat: 34.0522,
                lng: -118.2437,
                employees: 280,
                revenue: 65000000,
                opportunity: 252000,
                priority: "high",
                notes: "7th fastest-growing firm. Strong nonprofit/entertainment CAS. Tech-forward."
            },
            {
                id: 17,
                name: "GBQ",
                city: "Columbus",
                state: "OH",
                region: "midwest",
                lat: 39.9612,
                lng: -82.9988,
                employees: 350,
                revenue: 75000000,
                opportunity: 315000,
                priority: "high",
                notes: "Top 100 firm. Strong Midwest presence. Growing CAS practice."
            },
            {
                id: 18,
                name: "Whitley Penn",
                city: "Fort Worth",
                state: "TX",
                region: "southwest",
                lat: 32.7555,
                lng: -97.3308,
                employees: 750,
                revenue: 170000000,
                opportunity: 675000,
                priority: "high",
                notes: "Largest Texas-based firm. Fast-growing. Strong CAS for energy sector."
            },
            {
                id: 19,
                name: "Eide Bailly",
                city: "Fargo",
                state: "ND",
                region: "midwest",
                lat: 46.8772,
                lng: -96.7898,
                employees: 3200,
                revenue: 580000000,
                opportunity: 2880000,
                priority: "high",
                notes: "Top 25 firm. Strong CAS practice. Major presence in agribusiness."
            },
            {
                id: 20,
                name: "Marcum",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7527,
                lng: -73.9772,
                employees: 3200,
                revenue: 870000000,
                opportunity: 2880000,
                priority: "high",
                notes: "Top 15 firm. Aggressive M&A strategy. Strong CAS and advisory."
            },
            {
                id: 43,
                name: "LBMC",
                city: "Nashville",
                state: "TN",
                region: "southeast",
                lat: 36.1627,
                lng: -86.7816,
                employees: 650,
                revenue: 140000000,
                opportunity: 585000,
                priority: "high",
                notes: "Tennessee's largest accounting firm. Strong CAS/outsourcing. Tech-forward."
            },
            {
                id: 44,
                name: "Schneider Downs",
                city: "Pittsburgh",
                state: "PA",
                region: "northeast",
                lat: 40.4406,
                lng: -79.9959,
                employees: 550,
                revenue: 110000000,
                opportunity: 495000,
                priority: "high",
                notes: "Top 60 firm. Strong CAS practice. Technology consulting background."
            },

            // === MEDIUM PRIORITY ===
            {
                id: 21,
                name: "Plante Moran",
                city: "Southfield",
                state: "MI",
                region: "midwest",
                lat: 42.4734,
                lng: -83.2219,
                employees: 4600,
                revenue: 850000000,
                opportunity: 4140000,
                priority: "medium",
                notes: "Top 15 firm. Best workplace culture. Large but selective on new tech."
            },
            {
                id: 22,
                name: "CLA (CliftonLarsonAllen)",
                city: "Minneapolis",
                state: "MN",
                region: "midwest",
                lat: 44.9778,
                lng: -93.2650,
                employees: 9300,
                revenue: 1800000000,
                opportunity: 8370000,
                priority: "medium",
                notes: "8th largest US firm. Very large = longer sales cycle. Strong CAS but enterprise complexity."
            },
            {
                id: 23,
                name: "Crowe",
                city: "Chicago",
                state: "IL",
                region: "midwest",
                lat: 41.8781,
                lng: -87.6298,
                employees: 6600,
                revenue: 1200000000,
                opportunity: 5940000,
                priority: "medium",
                notes: "Top 10 firm. Large enterprise. Strong tech but may have competing internal solutions."
            },
            {
                id: 24,
                name: "Forvis Mazars",
                city: "St. Louis",
                state: "MO",
                region: "midwest",
                lat: 38.6270,
                lng: -90.1994,
                employees: 6000,
                revenue: 1500000000,
                opportunity: 5400000,
                priority: "medium",
                notes: "Newly merged Top 10 firm. Major transformation = potential but complex decision-making."
            },
            {
                id: 25,
                name: "CBIZ",
                city: "Cleveland",
                state: "OH",
                region: "midwest",
                lat: 41.4993,
                lng: -81.6944,
                employees: 7200,
                revenue: 1700000000,
                opportunity: 6480000,
                priority: "medium",
                notes: "Publicly traded. #7 largest. Aggressive M&A. Large = complex procurement."
            },
            {
                id: 26,
                name: "RSM US",
                city: "Chicago",
                state: "IL",
                region: "midwest",
                lat: 41.8827,
                lng: -87.6233,
                employees: 13000,
                revenue: 3200000000,
                opportunity: 11700000,
                priority: "medium",
                notes: "$1B AI investment announced. Very large but actively investing in AI."
            },
            {
                id: 27,
                name: "Baker Tilly",
                city: "Chicago",
                state: "IL",
                region: "midwest",
                lat: 41.8819,
                lng: -87.6278,
                employees: 11000,
                revenue: 2800000000,
                opportunity: 9900000,
                priority: "medium",
                notes: "6th largest after Moss Adams merger. Scale creates opportunity but complexity."
            },
            {
                id: 28,
                name: "UHY",
                city: "Farmington Hills",
                state: "MI",
                region: "midwest",
                lat: 42.4989,
                lng: -83.3677,
                employees: 900,
                revenue: 180000000,
                opportunity: 810000,
                priority: "medium",
                notes: "Strong CAS offerings. Mid-size. Global network provides scale."
            },
            {
                id: 29,
                name: "Mazars USA",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7549,
                lng: -73.9840,
                employees: 1100,
                revenue: 220000000,
                opportunity: 990000,
                priority: "medium",
                notes: "Part of Forvis Mazars merger. Transition period may slow decisions."
            },
            {
                id: 30,
                name: "Andersen",
                city: "San Francisco",
                state: "CA",
                region: "west",
                lat: 37.7749,
                lng: -122.4194,
                employees: 2000,
                revenue: 500000000,
                opportunity: 1800000,
                priority: "medium",
                notes: "Top 100 firm. Rebuilt brand. Focus on tax may limit CAS opportunity."
            },
            {
                id: 31,
                name: "Rehmann",
                city: "Troy",
                state: "MI",
                region: "midwest",
                lat: 42.6064,
                lng: -83.1498,
                employees: 720,
                revenue: 170000000,
                opportunity: 648000,
                priority: "medium",
                notes: "Strong Midwest presence. Growing CAS practice. 24% growth rate."
            },
            {
                id: 32,
                name: "HCVT",
                city: "Los Angeles",
                state: "CA",
                region: "west",
                lat: 34.0195,
                lng: -118.4912,
                employees: 700,
                revenue: 160000000,
                opportunity: 630000,
                priority: "medium",
                notes: "Strong West Coast presence. Tax-heavy but growing advisory/CAS."
            },
            {
                id: 33,
                name: "Herbein + Company",
                city: "Reading",
                state: "PA",
                region: "northeast",
                lat: 40.3356,
                lng: -75.9269,
                employees: 300,
                revenue: 55000000,
                opportunity: 270000,
                priority: "medium",
                notes: "Regional Pennsylvania firm. Growing CAS practice. Tech-curious culture."
            },
            {
                id: 34,
                name: "RKL",
                city: "Lancaster",
                state: "PA",
                region: "northeast",
                lat: 40.0379,
                lng: -76.3055,
                employees: 500,
                revenue: 95000000,
                opportunity: 450000,
                priority: "medium",
                notes: "Strong Mid-Atlantic presence. Growing through acquisitions. CAS focus."
            },
            {
                id: 41,
                name: "Pinion",
                city: "Loveland",
                state: "CO",
                region: "west",
                lat: 40.3978,
                lng: -105.0750,
                employees: 715,
                revenue: 125000000,
                opportunity: 643500,
                priority: "medium",
                notes: "Top 100 firm. Already has innovation team testing AI tools. 28% growth."
            },
            {
                id: 42,
                name: "Landmark CPAs",
                city: "Raleigh",
                state: "NC",
                region: "southeast",
                lat: 35.7996,
                lng: -78.6582,
                employees: 249,
                revenue: 42000000,
                opportunity: 224100,
                priority: "medium",
                notes: "Fast-growing regional firm. 24% growth rate. Emerging CAS practice."
            },
            {
                id: 45,
                name: "Hancock Askew",
                city: "Savannah",
                state: "GA",
                region: "southeast",
                lat: 32.0809,
                lng: -81.0912,
                employees: 200,
                revenue: 35000000,
                opportunity: 180000,
                priority: "medium",
                notes: "Regional Southeast firm. Growing CAS practice. Interested in efficiency tools."
            },

            // === LOW PRIORITY ===
            {
                id: 35,
                name: "BDO USA",
                city: "Chicago",
                state: "IL",
                region: "midwest",
                lat: 41.8927,
                lng: -87.6333,
                employees: 8500,
                revenue: 2300000000,
                opportunity: 7650000,
                priority: "low",
                notes: "5th largest globally. Very large enterprise = long sales cycle, may build internally."
            },
            {
                id: 36,
                name: "Grant Thornton",
                city: "Chicago",
                state: "IL",
                region: "midwest",
                lat: 41.8881,
                lng: -87.6398,
                employees: 10000,
                revenue: 2500000000,
                opportunity: 9000000,
                priority: "low",
                notes: "Top 6 firm. Very large = likely to build vs buy. Complex procurement."
            },
            {
                id: 37,
                name: "Deloitte",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7580,
                lng: -73.9855,
                employees: 175000,
                revenue: 59000000000,
                opportunity: 0,
                priority: "low",
                notes: "Big 4. Building own AI solutions. Not a realistic target for startups."
            },
            {
                id: 38,
                name: "PwC",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7614,
                lng: -73.9776,
                employees: 150000,
                revenue: 53000000000,
                opportunity: 0,
                priority: "low",
                notes: "Big 4. Massive internal R&D. Not a realistic target for startups."
            },
            {
                id: 39,
                name: "EY",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7549,
                lng: -73.9940,
                employees: 140000,
                revenue: 49000000000,
                opportunity: 0,
                priority: "low",
                notes: "Big 4. $1.4B AI investment. Building internally. Not realistic target."
            },
            {
                id: 40,
                name: "KPMG",
                city: "New York",
                state: "NY",
                region: "northeast",
                lat: 40.7484,
                lng: -73.9857,
                employees: 36000,
                revenue: 14000000000,
                opportunity: 0,
                priority: "low",
                notes: "Big 4. Major internal AI initiatives. Not a realistic target for startups."
            }
        ];

        // ============================================
        // HELPER FUNCTIONS
        // ============================================

        function formatCurrency(amount) {
            if (amount >= 1000000000) {
                return '$' + (amount / 1000000000).toFixed(1) + 'B';
            } else if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(0) + 'K';
            }
            return '$' + amount;
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        function getPriorityLabel(priority) {
            const labels = {
                'current': 'Customer',
                'high': 'High',
                'medium': 'Medium',
                'low': 'Low'
            };
            return labels[priority] || priority;
        }

        function getMarkerColor(priority) {
            const colors = {
                'current': '#5a8a95',
                'high': '#4ade80',
                'medium': '#fbbf24',
                'low': '#6b7280'
            };
            return colors[priority] || '#6b7280';
        }

        // ============================================
        // FILTERING
        // ============================================

        let activeFilters = {
            priority: 'all',
            region: 'all',
            opportunity: 'all'
        };

        function filterFirms() {
            return firms.filter(firm => {
                if (activeFilters.priority !== 'all' && firm.priority !== activeFilters.priority) {
                    return false;
                }
                if (activeFilters.region !== 'all' && firm.region !== activeFilters.region) {
                    return false;
                }
                if (activeFilters.opportunity !== 'all') {
                    switch (activeFilters.opportunity) {
                        case '1m+':
                            if (firm.opportunity < 1000000) return false;
                            break;
                        case '500k+':
                            if (firm.opportunity < 500000) return false;
                            break;
                        case '250k+':
                            if (firm.opportunity < 250000) return false;
                            break;
                        case 'under250k':
                            if (firm.opportunity >= 250000) return false;
                            break;
                    }
                }
                return true;
            });
        }

        function updateDisplay() {
            const filtered = filterFirms();

            document.querySelectorAll('.firm-card').forEach(card => {
                const firmId = parseInt(card.dataset.firmId);
                const firm = firms.find(f => f.id === firmId);
                if (filtered.includes(firm)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });

            firms.forEach(firm => {
                const marker = markers[firm.id];
                if (filtered.includes(firm)) {
                    marker.setStyle({ opacity: 1, fillOpacity: 0.85 });
                } else {
                    marker.setStyle({ opacity: 0.1, fillOpacity: 0.1 });
                }
            });

            const totalOpp = filtered.reduce((sum, f) => sum + f.opportunity, 0);
            const totalEmp = filtered.reduce((sum, f) => sum + f.employees, 0);

            document.getElementById('filtered-count').textContent = filtered.length;
            document.getElementById('total-opportunity').textContent = formatCurrency(totalOpp);
            document.getElementById('total-employees').textContent = formatNumber(totalEmp);
            document.getElementById('showing-count').textContent = filtered.length + ' firms';
        }

        // ============================================
        // INITIALIZE MAP
        // ============================================

        const map = L.map('map').setView([39.8283, -98.5795], 4);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        const markers = {};

        // ============================================
        // ADD MARKERS
        // ============================================

        firms.forEach(firm => {
            const color = getMarkerColor(firm.priority);
            const baseSize = 6;
            const maxSize = 18;
            const oppNormalized = Math.min(firm.opportunity / 5000000, 1);
            const size = baseSize + (oppNormalized * (maxSize - baseSize));

            const marker = L.circleMarker([firm.lat, firm.lng], {
                radius: size,
                fillColor: color,
                color: '#1a1d21',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.85
            }).addTo(map);

            const popupContent = `
                <div class="popup-title">${firm.name}</div>
                <div class="popup-detail"><strong>Location:</strong> ${firm.city}, ${firm.state}</div>
                <div class="popup-detail"><strong>Employees:</strong> ${formatNumber(firm.employees)}</div>
                <div class="popup-detail"><strong>Revenue:</strong> ${formatCurrency(firm.revenue)}</div>
                <div class="popup-detail"><strong>Priority:</strong> ${getPriorityLabel(firm.priority)}</div>
                <div class="popup-notes">${firm.notes}</div>
                <div class="popup-opportunity">${firm.opportunity > 0 ? formatCurrency(firm.opportunity) + ' opportunity' : 'N/A'}</div>
            `;

            marker.bindPopup(popupContent);
            markers[firm.id] = marker;
        });

        // ============================================
        // BUILD SIDEBAR
        // ============================================

        const firmList = document.getElementById('firm-list');

        const sortedFirms = [...firms].sort((a, b) => {
            if (a.priority === 'current') return -1;
            if (b.priority === 'current') return 1;
            return b.opportunity - a.opportunity;
        });

        sortedFirms.forEach(firm => {
            const card = document.createElement('div');
            card.className = 'firm-card';
            card.dataset.firmId = firm.id;

            const oppDisplay = firm.opportunity > 0
                ? formatCurrency(firm.opportunity) + ' opportunity'
                : 'N/A - Builds internally';
            const oppClass = firm.opportunity > 0 ? '' : 'na';

            card.innerHTML = `
                <div class="firm-header">
                    <div>
                        <div class="firm-name">${firm.name}</div>
                        <div class="firm-location">${firm.city}, ${firm.state}</div>
                    </div>
                    <div class="priority-badge priority-${firm.priority}">${getPriorityLabel(firm.priority)}</div>
                </div>
                <div class="firm-stats">
                    <div class="firm-stat">
                        <span class="firm-stat-label">Employees: </span>
                        <span class="firm-stat-value">${formatNumber(firm.employees)}</span>
                    </div>
                    <div class="firm-stat">
                        <span class="firm-stat-label">Revenue: </span>
                        <span class="firm-stat-value">${formatCurrency(firm.revenue)}</span>
                    </div>
                </div>
                <div class="firm-opportunity ${oppClass}">${oppDisplay}</div>
            `;

            card.addEventListener('click', () => {
                document.querySelectorAll('.firm-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                map.setView([firm.lat, firm.lng], 8);
                markers[firm.id].openPopup();
            });

            firmList.appendChild(card);
        });

        // ============================================
        // FILTER EVENTS
        // ============================================

        document.querySelectorAll('.filter-btn[data-priority]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn[data-priority]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                activeFilters.priority = btn.dataset.priority;
                updateDisplay();
            });
        });

        document.getElementById('region-filter').addEventListener('change', (e) => {
            activeFilters.region = e.target.value;
            updateDisplay();
        });

        document.getElementById('opportunity-filter').addEventListener('change', (e) => {
            activeFilters.opportunity = e.target.value;
            updateDisplay();
        });

        // Initial display
        updateDisplay();
    </script>
</body>
</html>
